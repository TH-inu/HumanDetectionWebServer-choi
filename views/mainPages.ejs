<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Login Page</title>
        <script src="https://cdn.socket.io/3.1.3/socket.io.min.js"></script>
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script>
            function dataProcessing(rowData) {
                // string to int array
                var csiData = []; var i = 0;
                rowData.forEach( rowData => { 
                    csiData[i++] = rowData.csi_data.split(', ').map(item => {
                    return parseInt(item, 10);
                    });
                });
                console.log(csiData);
                
                var data = [];
                for (var i = 0; i < 20; i++) {
                    data[i] = {
                        name: (i+1)+' of CSI Data',
                        data: csiData[i]
                    }
                }
                return data
            }
        </script>
        <script>
            var port = JSON.parse('<%- JSON.stringify(port) %>');
            console.log(port);
            var socket = io.connect("http://localhost:" + port);
            socket.on('csiData', function(data) {
                console.log(data);
                var plotData = dataProcessing(data);
                console.log(section1Graph);
                for (var i = 0; i < 20; i++) {
                    graph1.series[i].update((plotData[i]));

                }
                // section1Graph.series.setData(plotData);
                graph1.redraw();
            })
        </script>
    </head>
    <body>
        <div id="section1Graph"></div>
        <script>
            var rowData = JSON.parse('<%- JSON.stringify(csi_data) %>');
            var data = dataProcessing(rowData);
            console.log(data);

            let graph1 = Highcharts.chart('section1Graph', {

                title: {
                    text: 'Show Real Time CSI Data Graph'
                },
                yAxis: {
                    title: {
                        text: 'amplitude'
                    }
                },
                xAxis: {
                    accessibility: {
                        rangeDescription: 'Range: 1 to 64'
                    }
                },

                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle'
                },

                plotOptions: {
                    series: {
                        label: {
                            connectorAllowed: false
                        },
                        pointStart: 1
                    }
                },

                series: data,   // 그래프 데이터

                responsive: {
                    rules: [{
                        condition: {
                            maxWidth: 500
                        },
                        chartOptions: {
                            // legend: {
                            //     layout: 'horizontal',
                            //     align: 'center',
                            //     verticalAlign: 'bottom'
                            // }
                        }
                    }]
                }

            });
        </script>
    </body>
</html>
